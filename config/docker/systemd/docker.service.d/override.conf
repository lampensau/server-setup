[Service]
# Security settings for Docker daemon
ExecStart=
ExecStart=/usr/bin/dockerd --host=unix:///var/run/docker.sock --containerd=/run/containerd/containerd.sock

# Security enhancements
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/docker /var/run /run

# Resource limits
LimitNOFILE=1048576
LimitNPROC=1048576
LimitCORE=0

# Process settings
OOMScoreAdjust=-500
Restart=on-failure
RestartSec=5
TimeoutStartSec=120
TimeoutStopSec=30

# Capability restrictions
CapabilityBoundingSet=CAP_CHOWN CAP_DAC_OVERRIDE CAP_FSETID CAP_FOWNER CAP_MKNOD CAP_NET_RAW CAP_SETGID CAP_SETUID CAP_SETFCAP CAP_SETPCAP CAP_NET_BIND_SERVICE CAP_SYS_CHROOT CAP_KILL CAP_AUDIT_WRITE

# Systemd specific
Delegate=yes
TasksMax=infinity
KillMode=process