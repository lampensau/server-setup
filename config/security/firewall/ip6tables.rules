*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# Accept loopback
-A INPUT -i lo -j ACCEPT

# Accept established connections
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT

# Accept ICMPv6
-A INPUT -p icmpv6 -j ACCEPT

# Accept SSH, rate-limited
-A INPUT -p tcp --dport ${SSH_PORT} -m conntrack --ctstate NEW -m recent --set
-A INPUT -p tcp --dport ${SSH_PORT} -m conntrack --ctstate NEW -m recent --update --seconds 60 --hitcount 4 -j DROP
-A INPUT -p tcp --dport ${SSH_PORT} -j ACCEPT

# Accept HTTP/HTTPS
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT

COMMIT