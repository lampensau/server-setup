# Modern SSH Security Configuration - ED25519 Only
# Generated: $(date)
# No compatibility mode - maximum security

# Protocol and Networking
Protocol 2
Port ${SSH_PORT}
AddressFamily any
ListenAddress 0.0.0.0
ListenAddress ::

# Host Keys - ED25519 only, no compatibility
HostKey /etc/ssh/ssh_host_ed25519_key

# Cryptography - Post-quantum ready, ED25519 only
KexAlgorithms ${MODERN_KEXALGORITHMS}
Ciphers ${MODERN_CIPHERS}
MACs ${MODERN_MACS}
HostKeyAlgorithms ${MODERN_HOSTKEY_ALGORITHMS}
PubkeyAcceptedAlgorithms ${MODERN_PUBKEY_ALGORITHMS}

# Authentication - Public key only
LoginGraceTime 30
PermitRootLogin no
StrictModes yes
MaxAuthTries 3
MaxSessions 10
MaxStartups 10:30:60

# Public Key Authentication (only method allowed)
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys /etc/ssh/authorized_keys/%u

# Disable all other authentication methods
PasswordAuthentication no
ChallengeResponseAuthentication no
KerberosAuthentication no
GSSAPIAuthentication no
UsePAM yes

# Network and Session Settings
TCPKeepAlive yes
ClientAliveInterval 300
ClientAliveCountMax 2
Compression delayed
UseDNS no

# Logging and Monitoring
SyslogFacility AUTH
LogLevel VERBOSE

# File Transfer
Subsystem sftp internal-sftp -l INFO -u 0077

# Security Options
PermitEmptyPasswords no
PermitUserEnvironment no
AllowAgentForwarding ${ALLOW_AGENT_FORWARDING:-yes}
AllowTcpForwarding ${ALLOW_TCP_FORWARDING:-yes}
PermitTunnel no
DebianBanner no
GatewayPorts no
X11Forwarding no
PrintMotd no
PrintLastLog yes

# Rate limiting (helps prevent DoS)
# This works in conjunction with iptables rules